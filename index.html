<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sashiko Pattern Designer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div id="app">
    <div class="header-container">
      <h1>Sashiko Pattern Designer</h1>
      <a href="https://github.com/leifrogers/sashiko-designer" target="_blank" rel="noopener noreferrer"
        class="github-link" title="View on GitHub">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
        </svg>
      </a>
    </div>
    <div id="controls">
      <div id="drawing-tools">
        <button id="selectMode" class="tool-btn" title="Select Mode (V) - Click to select and edit stitches"><img
            src="icons/mouse-pointer-2.svg" alt="Select" class="icon"></button>
        <button id="toolLine" class="tool-btn active" title="Line Tool - Draw straight lines"><img
            src="icons/pencil-line.svg" alt="Draw Line" class="icon"></button>
        <button id="toolCircle" class="tool-btn" title="Circle Tool - Draw circles"><img src="icons/circle.svg"
            alt="Circle" class="icon"></button>
        <button id="toolBox" class="tool-btn" title="Box Tool - Draw rectangles"><img src="icons/square.svg" alt="Box"
            class="icon"></button>
        <button id="toolCurve" class="tool-btn" title="Curve Tool - Draw curved lines with control points">
          <img src="icons/spline.svg" alt="Curve" class="icon">
        </button>
        <button id="toolPen" class="tool-btn" title="Pen Tool - Draw freehand paths with smoothing">
          <img src="icons/pen-tool.svg" alt="Pen Tool" class="icon">
        </button>
        <button id="toolFillCircle" class="tool-btn" title="Filled Circle - Draw circles with cross-hatch fill">
          <img src="icons/circle.svg" alt="Filled Circle" class="icon fill-icon">
        </button>
        <button id="toolFillBox" class="tool-btn" title="Filled Box - Draw rectangles with cross-hatch fill">
          <img src="icons/square.svg" alt="Filled Box" class="icon fill-icon">
        </button>
        <button id="toolFillTriangle" class="tool-btn"
          title="Filled Triangle - Draw triangles with cross-hatch fill (3 clicks)">
          <svg class="icon fill-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2">
            <path d="M12 2 L22 22 L2 22 Z" />
          </svg>
        </button>
      </div>
      <div id="edit-tools">
        <button id="undo" class="tool-btn" title="Undo Last Action (Ctrl+Z)"><img src="icons/undo.svg" alt="Undo"
            class="icon"></button>

        <button id="toggleGrid" title="Toggle Grid Visibility"><img src="icons/grid-3x3.svg" alt="Toggle Grid"
            class="icon"></button>
        <button id="clear" title="Clear Canvas - Remove all stitches"><img src="icons/brush-cleaning.svg"
            alt="Clear Canvas" class="icon"></button>
        <button id="savePattern" title="Save Pattern - Download as image">
          <img src="icons/image-down.svg" alt="Save" class="icon">
        </button>
        <button id="helpBtn" class="tool-btn" title="Show Help - Keyboard shortcuts and tools">
          <img src="icons/circle-question-mark.svg" alt="Help" class="icon">
        </button>
      </div>
      <label><input type="checkbox" id="stitchLock"> Lock to Grid</label>

      <!-- Authentic Sashiko Mode (Phase 1.1) -->
      <div class="control-group authentic-mode-section">
        <label class="control-label">
          <input type="checkbox" id="authenticMode"> 
          <strong>Authentic Sashiko Mode</strong>
        </label>
        <p class="help-text">Traditional Japanese sashiko stitch parameters with 3:2 front/back ratio</p>
        
        <div id="authenticSettings" style="display: none; margin-top: 12px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 4px;">
          <div class="authentic-control">
            <label class="control-label">
              Front Stitch Length: 
              <input type="range" id="authenticStitchLength" min="3.0" max="5.0" step="0.1" value="3.5">
              <span id="authenticStitchLengthValue" class="value-display">3.5mm</span>
            </label>
            <p class="param-info">Standard range: 3-5mm (3.5mm typical)</p>
          </div>
          
          <div class="authentic-control">
            <label class="control-label">
              Stitch Density: 
              <input type="range" id="authenticDensity" min="2.0" max="3.0" step="0.1" value="2.5">
              <span id="authenticDensityValue" class="value-display">2.5 stitches/cm</span>
            </label>
            <p class="param-info">Traditional: 2-3 stitches per centimeter</p>
          </div>
          
          <div class="authentic-info">
            <p><strong>Automatic Parameters:</strong></p>
            <ul>
              <li>Back stitch: 2/3 of front (3:2 ratio)</li>
              <li>Gap: 1/3 of front stitch length</li>
              <li>Conversion: 1mm = 3.78px (96 DPI)</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="control-group">
        <label class="control-label">Stitch Gap Ratio:</label>
        <div class="radio-group">
          <label class="radio-label"><input type="radio" name="gapRatio" value="0.33" id="gap1-3"> 1/3</label>
          <label class="radio-label"><input type="radio" name="gapRatio" value="0.5" id="gap1-2" checked> 1/2</label>
          <label class="radio-label"><input type="radio" name="gapRatio" value="custom" id="gapCustom"> Custom</label>
        </div>
        <div id="customGapControl" style="display: none; margin-top: 8px;">
          <label>Gap Ratio: <input type="range" id="customGapRatio" min="0.1" max="1.0" step="0.05" value="0.5">
            <span id="gapRatioValue">0.50</span>
          </label>
        </div>
        <p class="help-text" style="margin-top: 4px; font-size: 0.85em; opacity: 0.7;">
          Note: Gap ratio is overridden to 1/3 when Authentic Sashiko Mode is enabled
        </p>
      </div>

      <label>Stitch Color: <input type="color" id="stitchColor" value="#ffffff"></label>
    </div>
    <div id="canvas-container"></div>
  </div>

  <!-- Help Modal -->
  <div id="helpModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Sashiko Pattern Designer - Help</h2>

      <div class="help-section">
        <h3>Drawing Tools</h3>
        <ul>
          <li><strong>Line Tool</strong> - Draw straight lines between two points</li>
          <li><strong>Circle Tool</strong> - Draw circles from center to radius</li>
          <li><strong>Box Tool</strong> - Draw rectangles by defining corners</li>
          <li><strong>Curve Tool</strong> - Draw smooth curves with control points</li>
          <li><strong>Pen Tool</strong> - Draw freehand paths with automatic smoothing</li>
          <li><strong>Filled Circle</strong> - Draw circles filled with cross-hatch stitch pattern</li>
          <li><strong>Filled Box</strong> - Draw rectangles filled with cross-hatch stitch pattern</li>
          <li><strong>Filled Triangle</strong> - Draw triangles filled with cross-hatch pattern (3 clicks to define
            vertices)</li>
        </ul>
      </div>

      <div class="help-section">
        <h3>Edit Mode</h3>
        <ul>
          <li><strong>Select Mode (V)</strong> - Click any stitch to select it</li>
          <li><strong>Drag Control Points</strong> - Move yellow circles to adjust shape</li>
          <li><strong>Color Editing</strong> - Change stitch color picker to update selected stitch</li>
          <li><strong>Delete (Del)</strong> - Remove selected stitch</li>
          <li><strong>Deselect (Esc)</strong> - Clear selection</li>
        </ul>
      </div>

      <div class="help-section">
        <h3>Path Point Editing</h3>
        <p>When a path is selected, click on individual points to edit:</p>
        <ul>
          <li><strong>Delete Key</strong> - Delete selected point (minimum 3 points required)</li>
          <li><strong>M Key</strong> - Merge selected point with next point</li>
          <li><strong>Drag Points</strong> - Move individual path points</li>
        </ul>
      </div>

      <div class="help-section">
        <h3>Camera Navigation</h3>
        <ul>
          <li><strong>Mouse Wheel</strong> - Zoom in/out (centered on cursor position)</li>
          <li><strong>Spacebar + Drag</strong> - Pan the canvas to explore large designs</li>
          <li><strong>+ or =</strong> - Zoom in</li>
          <li><strong>- or _</strong> - Zoom out</li>
          <li><strong>0 (zero)</strong> - Reset view to default zoom and position</li>
        </ul>
      </div>

      <div class="help-section">
        <h3>Keyboard Shortcuts</h3>
        <ul>
          <li><strong>V</strong> - Switch to Select Mode</li>
          <li><strong>Ctrl+Z / Cmd+Z</strong> - Undo last action</li>
          <li><strong>Delete / Backspace</strong> - Delete selected stitch</li>
          <li><strong>Escape</strong> - Deselect current selection</li>
          <li><strong>Selected Point + Delete</strong> - Delete selected path point</li>
          <li><strong>Selected Point + M</strong> - Merge selected path point with next</li>
        </ul>
      </div>

      <div class="help-section">
        <h3>Settings</h3>
        <ul>
          <li><strong>Authentic Sashiko Mode</strong> - Enable traditional Japanese sashiko stitch parameters:
            <ul style="margin-top: 8px; padding-left: 20px;">
              <li>3:2 front/back stitch ratio (front stitches 1.5Ã— longer than back)</li>
              <li>Configurable front stitch length: 3-5mm (3.5mm typical)</li>
              <li>Gap ratio locked to 1/3 of stitch length (traditional standard)</li>
              <li>Stitch density: 2-3 stitches per centimeter</li>
              <li>Precise mm to pixel conversion (1mm = 3.78px at 96 DPI)</li>
            </ul>
          </li>
          <li><strong>Lock to Grid</strong> - Enable to snap points to grid intersections (20px grid). When unchecked,
            freehand mode is active for organic shapes</li>
          <li><strong>Stitch Gap Ratio</strong> - Control gap between stitches: 1/3 (tight), 1/2 (balanced), or custom
            ratio. <em>Note: Overridden to 1/3 when Authentic Sashiko Mode is enabled</em></li>
          <li><strong>Toggle Grid</strong> - Show/hide grid overlay</li>
          <li><strong>Stitch Color</strong> - Choose the color for new stitches</li>
        </ul>
        <p><em>Note: Grid size (20px) and default stitch length (10px) are fixed for consistent zoom/pan behavior, unless Authentic Sashiko Mode is enabled.</em></p>
      </div>

      <div class="help-section">
        <h3>Actions</h3>
        <ul>
          <li><strong>Undo</strong> - Revert last action (up to 50 actions)</li>
          <li><strong>Clear Canvas</strong> - Remove all stitches from canvas</li>
          <li><strong>Save Pattern</strong> - Download current pattern as PNG image</li>
        </ul>
      </div>
    </div>
  </div>

  <script src="sketch.js"></script>
</body>

</html>